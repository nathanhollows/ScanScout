<!-- Header --><div class=\"flex flex-col gap-3 md:flex-row justify-between items-center w-full p-5\"><h1 class=\"text-2xl font-bold\">Locations  <span class=\"badge badge-ghost\">
</span> <span class=\"htmx-indicator loading loading-dots loading-md text-info\">Updating</span></h1><span class=\"flex md:flex-row flex-wrap justify-center gap-5\">
<div class=\"join\"><a href=\"/admin/locations/qr-codes.zip\" class=\"btn btn-base btn-outline join-item mb-3 md:mb-0\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-image-down\"><path d=\"M10.3 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10l-3.1-3.1a2 2 0 0 0-2.814.014L6 21\"></path> <path d=\"m14 19 3 3v-5.5\"></path> <path d=\"m17 22 3-3\"></path> <circle cx=\"9\" cy=\"9\" r=\"2\"></circle></svg> QR codes</a> <a class=\"btn btn-base btn-outline join-item\" href=\"/admin/locations/posters.pdf\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-file-down\"><path d=\"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z\"></path> <path d=\"M14 2v4a2 2 0 0 0 2 2h4\"></path> <path d=\"M12 18v-6\"></path> <path d=\"m9 15 3 3 3-3\"></path></svg> Posters</a></div>
<a href=\"/admin/locations/new\" hx-boost=\"true\" class=\"btn btn-secondary\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-map-pin-plus w-5 h-5\"><path d=\"M19.914 11.105A7.298 7.298 0 0 0 20 10a8 8 0 0 0-16 0c0 4.993 5.539 10.193 7.399 11.799a1 1 0 0 0 1.202 0 32 32 0 0 0 .824-.738\"></path><circle cx=\"12\" cy=\"10\" r=\"3\"></circle><path d=\"M16 18h6\"></path><path d=\"M19 15v6\"></path></svg> Add Location</a></span></div><!-- Locations list --><div class=\"px-5\"><form
 class=\"join join-vertical w-full shadow sortable\"
 class=\"join join-vertical w-full shadow\"
 hx-post=\"/admin/locations/reorder\" hx-trigger=\"end\" hx-swap=\"none\" hx-indicator=\".htmx-indicator\">
<div class=\"flex flex-row justify-between items-center gap-3 bg-base-200 hover:bg-base-300 rounded-lg p-4 join-item\" data-order=\"
\"><div class=\"flex flex-row items-center gap-3 grow\"><!-- Drag handle -->
<div class=\"tooltip tooltip-right flex gap-3 cursor-move\" data-tip=\"Drag to reorder\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-grip-vertical\"><circle cx=\"9\" cy=\"12\" r=\"1\"></circle><circle cx=\"9\" cy=\"5\" r=\"1\"></circle><circle cx=\"9\" cy=\"19\" r=\"1\"></circle><circle cx=\"15\" cy=\"12\" r=\"1\"></circle><circle cx=\"15\" cy=\"5\" r=\"1\"></circle><circle cx=\"15\" cy=\"19\" r=\"1\"></circle></svg></div><input type=\"hidden\" name=\"location\" value=\"
\">
<!-- Marker icon -->
<span class=\"tooltip cursor-help\" data-tip=\"Has coordinates\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-map-pin\"><path d=\"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z\"></path> <circle cx=\"12\" cy=\"10\" r=\"3\"></circle></svg></span>
<span class=\"tooltip cursor-help\" data-tip=\"No coordinates set\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-map-pin-off tooltip\" data-tip=\"Location has no coordinates set\"><path d=\"M5.43 5.43A8.06 8.06 0 0 0 4 10c0 6 8 12 8 12a29.94 29.94 0 0 0 5-5\"></path> <path d=\"M19.18 13.52A8.66 8.66 0 0 0 20 10a8 8 0 0 0-8-8 7.88 7.88 0 0 0-3.52.82\"></path> <path d=\"M9.13 9.13A2.78 2.78 0 0 0 9 10a3 3 0 0 0 3 3 2.78 2.78 0 0 0 .87-.13\"></path> <path d=\"M14.9 9.25a3 3 0 0 0-2.15-2.16\"></path> <line x1=\"2\" x2=\"22\" y1=\"2\" y2=\"22\"></line></svg></span>
<!-- Clue indicator -->
<span class=\"tooltip text-neutral cursor-help\" data-tip=\"No clues\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-search-x\"><path d=\"m13.5 8.5-5 5\"></path><path d=\"m8.5 8.5 5 5\"></path><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><path d=\"m21 21-4.3-4.3\"></path></svg></span>
<span class=\"tooltip cursor-help\" data-tip=\"Has clues\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-search\"><circle cx=\"11\" cy=\"11\" r=\"8\"></circle><path d=\"m21 21-4.3-4.3\"></path></svg></span>
<!-- Location code --><div class=\"badge badge-ghost basis-16 tooltip\" data-tip=\"Unique location code\"><code>
</code></div><!-- Location name --><a href=\"
\" class=\"link flex-grow\" hx-boost=\"true\" hx-swap=\"outerHTML\">
</a> 
<span class=\"badge\">
 pts</span>
</div></div>
</form></div><script>\nhtmx.onLoad(function(content) {\n    var sortables = content.querySelectorAll(\".sortable\");\n    for (var i = 0; i < sortables.length; i++) {\n      var sortable = sortables[i];\n      var sortableInstance = new Sortable(sortable, {\n          animation: 150,\n          ghostClass: 'blue-background-class',\n          handle: \".cursor-move\",\n\n          // Make the `.htmx-indicator` unsortable\n          filter: \".htmx-indicator\",\n          onMove: function (evt) {\n            return evt.related.className.indexOf('htmx-indicator') === -1;\n          },\n\n          // Disable sorting on the `end` event\n          onEnd: function (evt) {\n            this.option(\"disabled\", true);\n          }\n      });\n\n      // Re-enable sorting on the `htmx:afterSwap` event\n      sortable.addEventListener(\"htmx:afterSwap\", function() {\n        sortableInstance.option(\"disabled\", false);\n      });\n    }\n})\n</script>
<form class=\"flex flex-col gap-5 w-full p-5 max-w-2xl mx-auto\" method=\"post\" hx-post=\"/admin/locations/new\"><!-- Header --><div class=\"flex flex-col gap-3 md:flex-row justify-between items-center w-full\"><h1 class=\"text-2xl font-bold\">Add a location</h1><button type=\"submit\" class=\"btn btn-primary\">Save</button></div><div class=\"flex flex-col md:flex-row gap-3\"><label class=\"form-control w-full\"><div class=\"label\"><span class=\"label-text font-bold\">Location name</span></div><input id=\"name\" name=\"name\" type=\"text\" placeholder=\"Location name\" class=\"input input-bordered w-full\" autocomplete=\"off\" required></label> 
<label for=\"points\" class=\"form-control w-full\"><div class=\"label\"><span class=\"label-text font-bold\">Points</span></div><input type=\"number\" id=\"points\" name=\"points\" class=\"input input-bordered w-full\" value=\"10\" placeholder=\"Enter points\" required></label>
</div><!-- Map --><div class=\"form-control\"><label class=\"\"><span class=\"label-text font-bold p-2 mb-2\">Map marker</span><div id=\"geocoder\" class=\"geocoder mt-2\"></div></label></div><div id=\"map\" class=\"w-full h-96 rounded-lg shadow-lg\"></div><div class=\"form-control\"><label class=\"label cursor-pointer font-bold\"><span class=\"label-text\">Physical location</span> <input type=\"checkbox\" name=\"location\" class=\"toggle toggle-primary\"></label></div><input type=\"hidden\" name=\"latitude\"> <input type=\"hidden\" name=\"longitude\"></form>
<form hx-post=\"
\" hx-trigger=\"submit\" hx-swap=\"none\"><!-- Header --><div class=\"flex flex-col sm:flex-row gap-3 justify-between items-center w-full p-5\"><h1 class=\"text-2xl font-bold\">Editing <em>
</em></h1><div class=\"flex gap-3\"><div class=\"dropdown\"><div tabindex=\"0\" role=\"button\" class=\"btn btn-outline\">Downloads <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-chevron-down w-4 h-4\"><path d=\"m6 9 6 6 6-6\"></path></svg></div><ul tabindex=\"0\" class=\"dropdown-content menu bg-base-100 rounded-box z-[1] w-52 p-2 shadow\"><h2 class=\"menu-title\">Pre-made</h2><li><ul><li><a href=\"
\">
Posters (PDF)
Poster (PDF)
</a></li></ul></li><h2 class=\"menu-title\">Check-In</h2><li><ul><li><a href=\"
\" download=\"
\">QR Code (PNG)</a></li><li><a href=\"
\" download=\"
\">QR Code (SVG)</a></li></ul></li>
<h2 class=\"menu-title\">Check-Out</h2><li><ul><li><a href=\"
\" download=\"
\">QR Code (PNG)</a></li><li><a href=\"
\" download=\"
\">QR Code (SVG)</a></li></ul></li>
</ul></div><button type=\"button\" class=\"btn btn-error\" onclick=\"confirm_delete_modal.showModal();\">Delete</button> <button type=\"submit\" class=\"btn btn-primary\">Save</button></div></div><div class=\"flex-grow mx-auto\"><div class=\"flex flex-col md:flex-row p-5 pt-0 gap-5 lg:gap-20\"><div class=\"flex flex-col flex-grow\"><div class=\"flex flex-col sm:flex-row gap-5 mb-5\"><!-- Location Title --><label for=\"name\" class=\"form-control w-full md:w-1/2\"><div class=\"label\"><span class=\"label-text font-bold\">Location name</span></div><input type=\"text\" id=\"name\" name=\"name\" class=\"input input-bordered w-full\" value=\"
\" placeholder=\"Location name\"></label> 
<!-- Location Points --> <label for=\"points\" class=\"form-control w-full md:w-1/2\"><div class=\"label\"><span class=\"label-text font-bold\">Points</span> 
<span class=\"label-text-alt\"><span class=\"flex gap-1 badge badge-outline badge-sm tooltip cursor-help\" data-tip=\"Points are currently disabled\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-info w-3 h-3\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><path d=\"M12 16v-4\"></path><path d=\"M12 8h.01\"></path></svg> Disabled</span></span>
</div><input type=\"number\" id=\"points\" name=\"points\" class=\"input input-bordered w-full\" value=\"
\" placeholder=\"Enter points\"></label>
<input type=\"hidden\" name=\"points\" value=\"
\">
</div><!-- Clues -->
<section class=\"mb-8\"><div class=\"label flex justify-between\"><div class=\"flex flex-row-reverse justify-end md:justify-start md:flex-row\"><strong>Clues</strong><div class=\"dropdown dropdown-hover\"><div tabindex=\"0\" role=\"button\" class=\"btn btn-circle btn-ghost btn-xs text-info\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-circle-alert w-4 h-4 text-info\"><circle cx=\"12\" cy=\"12\" r=\"10\"></circle><line x1=\"12\" x2=\"12\" y1=\"8\" y2=\"12\"></line><line x1=\"12\" x2=\"12.01\" y1=\"16\" y2=\"16\"></line></svg></div><div tabindex=\"0\" class=\"card compact dropdown-content bg-base-200 rounded-box z-[1] w-64 shadow\"><div tabindex=\"0\" class=\"card-body\"><h2 class=\"card-title\">Clues</h2><p class=\"text-wrap\">Each team is shown one randomly selected clue.</p><p class=\"text-wrap\">If no clues are available then the player is told the name of the location as a freebie.</p><p class=\"text-wrap\">Clues may contain <a class=\"link\" href=\"/admin/markdown\" target=\"blank\">Markdown</a> formatting.</p></div></div></div></div><button class=\"add-clue-btn btn btn-sm btn-neutral my-2\" type=\"button\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-list-plus w-5 h-5\"><path d=\"M11 12H3\"></path><path d=\"M16 6H3\"></path><path d=\"M16 18H3\"></path><path d=\"M18 9v6\"></path><path d=\"M21 12h-6\"></path></svg> Add a clue</button></div><div id=\"clue-list\" class=\"flex flex-col join join-vertical\">
<div class=\"alert\"><span>There are no clues to show. Do you want to <a class=\"link add-clue-btn\">add a clue</a>? </span></div>
<label class=\"clue-line input input-bordered bg-transparent flex flex-row items-top gap-2 h-auto join-item\" data-item-id=\"
\"><input type=\"text\" name=\"clues\" class=\"w-full input hover:border-0 hover:outline-0 focus:border-0 focus:outline-0 border-0 outline-0 pr-8 pl-0 bg-transparent overflow-ellipsis\" value=\"
\" placeholder=\"Add a clue\" autoComplete=\"off\"> <input type=\"hidden\" name=\"clue-ids\" value=\"
\"> <button type=\"button\" class=\"btn btn-xs btn-circle hover:btn-error tooltip tooltip-left flex mt-3\" data-tip=\"Delete\" onclick=\"this.closest(&#39;.clue-line&#39;).remove()\" tabindex=\"-1\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-trash-2 w-3 h-3\"><path d=\"M3 6h18\"></path><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"></path><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"></path><line x1=\"10\" x2=\"10\" y1=\"11\" y2=\"17\"></line><line x1=\"14\" x2=\"14\" y1=\"11\" y2=\"17\"></line></svg></button></label>
</div></section>
<!-- Blocks --><section><div class=\"divider mt-5 mb-10\"><div class=\"dropdown\"><div class=\"block\"><div tabindex=\"0\" role=\"button\" class=\"btn btn-sm btn-neutral w-32 flex flex-col\"><svg class=\"w-5 h-5\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-plus\"><path d=\"M5 12h14\"></path><path d=\"M12 5v14\"></path></svg> Add a Block</div></div><div tabindex=\"0\" class=\"dropdown-content card bg-base-200 border border-base-300 shadow-lg w-80 -ml-24 mt-3 z-50\"><div class=\"card-body\"><h2 class=\"card-title mb-3\">Add a Block</h2><div class=\"grid grid-cols-2 grid-flow-row gap-5\">
<div class=\"indicator w-full\">
<span class=\"indicator-item indicator-top indicator-center badge badge-outline border-base-content/30 bg-base-100\">Interactive</span>
<div class=\"btn btn-outline border-base-content/30 h-auto p-3 tooltip flex flex-col gap-1 items-center rounded-md w-full\" data-tip=\"
\" hx-post=\"
\" hx-target=\"#blocks\" hx-swap=\"beforeend\">
</div></div>
</div></div></div></div></div><div id=\"blocks\" class=\"sortable\" hx-post=\"
\" hx-trigger=\"end\">
</div></section></div><!-- Sidebar --><aside class=\"flex flex-col\"><!-- Map --><div id=\"map-container\" class=\"relative w-full aspect-square md:w-[35vw] lg:w-96 rounded-lg shadow-lg mt-5\"><div id=\"map\" class=\"map w-full h-full rounded-lg\"></div><!-- Overlay Button and Backdrop --><div id=\"map-lock-overlay\" class=\"absolute inset-0 bg-base-300 bg-opacity-70 flex justify-center items-center opacity-0 hover:opacity-100 transition rounded-lg focus:opacity-100\" tabindex=\"0\"><button id=\"unlock-map-btn\" class=\"btn btn-neutral\" onclick=\"document.getElementById(&#39;map-lock-overlay&#39;).remove()\"><svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-lock-keyhole w-5 h-5\"><circle cx=\"12\" cy=\"16\" r=\"1\"></circle><rect x=\"3\" y=\"10\" width=\"18\" height=\"12\" rx=\"2\"></rect><path d=\"M7 10V7a5 5 0 0 1 10 0v3\"></path></svg> Unlock to edit</button></div></div><div class=\"form-control\"><label class=\"label cursor-pointer\"><span class=\"label-text\">Save map location</span> <input type=\"checkbox\" name=\"location\" class=\"checkbox checkbox-sm\" checked=\"checked\"></label></div><!-- Hidden inputs for form handling --><input type=\"hidden\" name=\"code\" value=\"
\"> <input type=\"hidden\" name=\"latitude\" value=\"
\"> <input type=\"hidden\" name=\"longitude\" value=\"
\"></aside></div></div></form><dialog id=\"block_edit_modal\" class=\"modal modal-bottom md:modal-middle\"></dialog> <dialog id=\"confirm_delete_block\" class=\"modal\"><div class=\"modal-box prose outline outline-2 outline-offset-1 outline-error\"><h3 class=\"text-lg font-bold\">Delete this block?</h3><p class=\"pt-4\">You are about to delete this block. Are you sure?</p><div class=\"modal-action\"><button type=\"button\" class=\"btn\" onclick=\"confirm_delete_block.close()\">Nevermind</button> <button type=\"button\" class=\"btn btn-error\" onclick=\"confirm_delete_block.close()\">Delete</button></div></div></dialog> <dialog id=\"confirm_delete_modal\" class=\"modal\"><div class=\"modal-box prose outline outline-2 outline-offset-1 outline-error\"><h3 class=\"text-lg font-bold\">Delete this location?</h3><p class=\"pt-4\">You are about to delete this location. Are you sure?</p><div class=\"modal-action\"><button type=\"button\" class=\"btn\" onclick=\"confirm_delete_modal.close()\">Nevermind</button> <button type=\"button\" class=\"btn btn-error\" hx-delete=\"
\" hx-trigger=\"click\" onclick=\"confirm_delete_modal.close()\">Delete</button></div></div></dialog><script>\n(() => {\n  const addClueBtns = document.querySelectorAll(\".add-clue-btn\");\n  const clueList = document.getElementById(\"clue-list\");\n  let alertRemoved = false; // Tracks if the alert has been removed\n\n  addClueBtns.forEach((btn) => {\n    btn.addEventListener(\"click\", function () {\n      // Remove the alert if present and not already removed\n      if (!alertRemoved) {\n        const existingAlert = clueList.querySelector(\".alert\");\n        if (existingAlert) {\n          existingAlert.remove();\n        }\n        alertRemoved = true; // Mark that alert has been removed\n      }\n\n      // Create the new clue input element based on the provided template\n      addNewClueField();\n    });\n  });\n\n  // Function to create and add a new clue field to the list\n  const addNewClueField = (value = \"\") => {\n    const newClueLine = document.createElement(\"label\");\n    newClueLine.classList.add(\n      \"clue-line\", \"input\", \"input-bordered\", \"bg-transparent\", \"flex\", \"flex-row\", \"items-top\", \"gap-2\", \"h-auto\", \"join-item\"\n    );\n\n    newClueLine.innerHTML = `\n      <input\n        type=\"text\"\n        name=\"clues\"\n        class=\"w-full input hover:border-0 hover:outline-0 focus:border-0 focus:outline-0 border-0 outline-0 pr-8 pl-0 bg-transparent overflow-ellipsis\"\n        placeholder=\"Add a clue\"\n        autoComplete=\"off\"\n        value=\"${value}\"\n      />\n      <button\n        type=\"button\"\n        class=\"btn btn-xs btn-circle hover:btn-error tooltip tooltip-left flex mt-3\"\n        data-tip=\"Delete\"\n        onclick=\"this.closest('.clue-line').remove()\"\n        tabindex=\"-1\"\n      >\n        <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"lucide lucide-trash-2 w-3 h-3\"><path d=\"M3 6h18\"></path><path d=\"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6\"></path><path d=\"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2\"></path><line x1=\"10\" x2=\"10\" y1=\"11\" y2=\"17\"></line><line x1=\"14\" x2=\"14\" y1=\"11\" y2=\"17\"></line></svg>\n      </button>\n    `;\n\n    // Add paste event to handle multi-line input\n    const inputField = newClueLine.querySelector('input[type=\"text\"]');\n    inputField.addEventListener(\"paste\", handlePasteEvent);\n\n    // Append the new clue line to the clue list\n    clueList.appendChild(newClueLine);\n  };\n\n  // Event handler for paste event\n  const handlePasteEvent = (event) => {\n    event.preventDefault(); // Prevent default paste behavior\n    const pasteData = (event.clipboardData || window.clipboardData).getData(\"text\");\n    const lines = pasteData.split(\"\\n\").filter(line => line.trim() !== \"\"); // Split and remove empty lines\n\n    // If only one line, just paste into the current field\n    if (lines.length === 1) {\n      event.target.value = lines[0];\n    } else {\n      // Otherwise, split lines into separate clue fields\n      event.target.value = lines[0]; // Set the first line to the current input\n      for (let i = 1; i < lines.length; i++) {\n        addNewClueField(lines[i]); // Create a new clue input for each additional line\n      }\n    }\n  };\n})();\ndocument.querySelector(\"#blocks\").addEventListener(\"htmx:afterSettle\", (event) => {\n    // Select the last .block-edit-btn inside #blocks\n    const blocks = document.querySelectorAll(\"#blocks .block-edit-btn\");\n    const lastBlockEditBtn = blocks[blocks.length - 1];\n\n    // Check if the element exists\n    if (lastBlockEditBtn) {\n        // Trigger a click event on the last .block-edit-btn\n        htmx.trigger(lastBlockEditBtn, \"click\");\n    }\n    \n});\n  function previewMD(e) {\n\tvar checkBox = e.target;\n\tvar id = e.target.dataset.block;\n    var textarea = document.getElementById(\"md-\" + id);\n    var preview = document.getElementById(\"preview-md-\" + id);\n\n    if (checkBox.checked == true){\n      textarea.classList.add(\"hidden\");\n      preview.classList.remove(\"hidden\");\n      preview.setAttribute(\"aria-busy\", true)\n      preview.innerHTML = \"<span class='loading loading-ring loading-lg'></span>\"\n\n      var xhr = new XMLHttpRequest();\n      xhr.open(\"POST\", '/admin/markdown/preview', true);\n      xhr.setRequestHeader('Content-Type', 'application/json');\n      xhr.send(JSON.stringify({\n        markdown: textarea.value\n      }));\n\n      xhr.onreadystatechange = (e) => {\n        preview.innerHTML = xhr.response\n      }\n    } else {\n      textarea.classList.remove(\"hidden\");\n      preview.classList.add(\"hidden\");\n      preview.innerHTML = null\n    }\n  }\n\nfunction sortables() {\n    var sortables = document.querySelectorAll(\".sortable\");\n    for (var i = 0; i < sortables.length; i++) {\n      var sortable = sortables[i];\n      var sortableInstance = new Sortable(sortable, {\n          animation: 150,\n          handle: \".cursor-move\",\n\n          // Make the `.htmx-indicator` unsortable\n          filter: \".htmx-indicator\",\n          onMove: function (evt) {\n            return evt.related.className.indexOf('htmx-indicator') === -1;\n          },\n\n          // Disable sorting on the `end` event\n          onEnd: function (evt) {\n            this.option(\"disabled\", true);\n          }\n      });\n\n      // Re-enable sorting on the `htmx:afterSwap` event\n      sortable.addEventListener(\"htmx:afterSwap\", function() {\n        sortableInstance.option(\"disabled\", false);\n      });\n    }\n}\nsortables();\n</script>
<script>\n(function () {\n  let map; // Store the map instance globally within the IIFE\n  let marker; // Store the marker instance globally within the IIFE\n\n  function initializeMap() {\n    let coords = [170.5111643, -45.8650509];\n    let zoom = 14;\n\n    // Check if longitude and latitude fields are set\n    if (document.querySelector('input[name=\"longitude\"]').value != \"\" && document.querySelector('input[name=\"latitude\"]').value != \"\") {\n      coords = [\n        parseFloat(document.querySelector('input[name=\"longitude\"]').value),\n        parseFloat(document.querySelector('input[name=\"latitude\"]').value)\n      ];\n      zoom = 16;\n    }\n\n    // Destroy existing map instance if it exists\n    if (map) {\n      map.remove();\n      map = null; // Explicitly set to null to clear reference\n    }\n\n    // Set the Mapbox access token\n    mapboxgl.accessToken = document.getElementById('mapbox_key').dataset.key;\n\n    // Determine map style based on color scheme\n    const style = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n      ? 'mapbox://styles/nathanhollows/cl9w3nxff002m14sy9fco4vnr'\n      : 'mapbox://styles/nathanhollows/clszboe2y005i01oid8ca37jm';\n\n    // Create the map\n    map = new mapboxgl.Map({\n      container: 'map',\n      style: style,\n      center: coords,\n      zoom: zoom\n    });\n\n    // Create and place marker\n    marker = new mapboxgl.Marker()\n      .setLngLat(coords)\n      .addTo(map);\n\n    // Update marker position on map drag\n    map.on('move', function() {\n      const center = map.getCenter();\n      marker.setLngLat(center);\n      document.querySelector('input[name=\"latitude\"]').value = center.lat;\n      document.querySelector('input[name=\"longitude\"]').value = center.lng;\n      document.querySelector('input[name=\"location\"]').checked = true;\n    });\n\n    // Update marker position on map drag\n    map.on('drag', function() {\n      const center = map.getCenter();\n      marker.setLngLat(center);\n      document.querySelector('input[name=\"latitude\"]').value = center.lat;\n      document.querySelector('input[name=\"longitude\"]').value = center.lng;\n      document.querySelector('input[name=\"location\"]').checked = true;\n    });\n\n    // Update marker position on map zoom\n    map.on('zoom', function() {\n      const center = map.getCenter();\n      marker.setLngLat(center);\n    });\n\n\n\t\tvar geocoderEl = document.getElementById('geocoder');\n\t\tif (geocoderEl) {\n\t\t\tvar geocoder = new MapboxGeocoder({\n\t\t\t\taccessToken: mapboxgl.accessToken,\n\t\t\t\tmapboxgl: mapboxgl,\n\t\t\t\tmarker: false,\n\t\t\t\tplaceholder: 'Search for an address or use the map',\n\t\t\t});\n\t\t\tgeocoderEl.appendChild(geocoder.onAdd(map));\n\t\t}\n\n    // Add event listener for location saving switch\n    document.querySelector('input[name=\"location\"]').addEventListener('change', function(e) {\n      if (e.target.checked) {\n        const center = map.getCenter();\n        marker.setLngLat(center);\n        document.querySelector('input[name=\"latitude\"]').value = center.lat;\n        document.querySelector('input[name=\"longitude\"]').value = center.lng;\n      } else {\n        document.querySelector('input[name=\"latitude\"]').value = \"\";\n        document.querySelector('input[name=\"longitude\"]').value = \"\";\n      }\n    });\n  }\n\n  // Delete block confirmation dialog\n  function confirmDeleteBlock(event) {\n\tmodal = document.getElementById(\"confirm_delete_block\");\n\turl = \"/admin/locations/\" + event.target.dataset.location + \"/blocks/\" + event.target.dataset.block + \"/delete\";\n\tbtn = modal.querySelector(\"button.btn-error\")\n\tbtn.setAttribute(\"hx-delete\", url);\n\tbtn.setAttribute(\"hx-swap\", \"outerHTML\");\n\tbtn.setAttribute(\"hx-target\", \"#\" + event.target.closest(\".collapse\").id);\n\tmodal.showModal();\n\thtmx.process(modal);\n  }\n\n  for (const element of document.querySelectorAll('.block-delete')) {\n\telement.addEventListener('click', confirmDeleteBlock);\n  }\n\n  // Add listener to #blocks for new blocks\n  if (document.getElementById(\"blocks\")) {\n  document.getElementById(\"blocks\").addEventListener(\"htmx:afterSwap\", function(event) {\n\t  for (const element of document.querySelectorAll('.block-delete')) {\n\t\telement.addEventListener('click', confirmDeleteBlock);\n\t  }\n  });\n  }\n\n  initializeMap();\n\n})();\n</script>
